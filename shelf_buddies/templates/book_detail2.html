{% extends 'base.html' %}
<!DOCTYPE html>
<html>
<head>
    <title>{{ book.title }}</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  <!-- jQuery library -->

</head>
<body>
{% block content %}
    <h1>{{ book.title }}</h1>
    <img src="{{ book.image }}" alt="{{ book.title }} cover">
    <p>Author: {{ book.author }}</p>
    <p>Genre: {{ book.genre }}</p>
    <p>ISBN: {{ book.isbn }}</p>
    <p>Total Pages: {{ book.total_pages }}</p>
    <button id="bookmarkButton">Bookmark</button>
    <div id="bookmarkOptions" style="display: none;">
        <button class="bookmarkOption" data-status="WANT_TO_READ">Want to Read</button>
        <button class="bookmarkOption" data-status="CURRENTLY_READING">Currently Reading</button>
        <button class="bookmarkOption" data-status="ALREADY_READ">Already Read</button>
    </div>
    <div id="readingProgress" style="display: none;">
        <label for="progress">Reading progress:</label>
        <input type="range" id="progressBar" name="progress" min="0" max="{{ book.total_pages }}">
        <p>I read <span id="progress">0</span> out of <span id="total">{{ book.total_pages }}</span>.</p>
        <button id="updateProgress">Update progress</button>
    </div>
    <br>
    {% if rating %}
        Your rating: {{ rating.rate }} out of 5
        <a href="{% url 'rate_book' google_books_id=book.google_books_id %}">Change your rating</a>
    {% else %}
        <a href="{% url 'rate_book' google_books_id=book.google_books_id %}">Rate this book</a>
    {% endif %}
    <br>
    <a href="{% url 'review_book' google_books_id=book.google_books_id %}"> Review </a>

    {% for comment in comments %}
    <br>
        {{comment.user.username}}: {{comment.review}}
    {% empty %}
        <a href="{% url 'review_book' google_books_id=book.google_books_id %}">Review</a>
    {% endfor %}

    {% endblock content %}

 
    <script>

    $.ajaxSetup({
        headers: { "X-CSRFToken": '{{ csrf_token }}' }
    });
        
    $(document).ready(function(){
        $("#bookmarkButton").click(function(){
            $("#bookmarkOptions").show();
        });
        $(".bookmarkOption").click(function(){
            var status = $(this).data('status');
            $.post("{% url 'bookmark' %}", {'book_id': '{{ book.google_books_id }}', 'reading_status': status}, function(data){
                alert(data);
                if (status == 'CURRENTLY_READING') {
                    $("#readingProgress").show();
                } else {
                    $("#readingProgress").hide();
                }
            });
        });
        $("#updateProgress").click(function(){
            var progress = $("#progressBar").val();  // Changed from "#progress" to "#progressBar"
            $.post("{% url 'bookmark' %}", {'book_id': '{{ book.google_books_id }}', 'reading_status': 'CURRENTLY_READING', 'reading_progress': progress}, function(data){
                alert(data);
            });
        });    
            
    });

    
    var progressBar = document.getElementById("progressBar");
    var progressText = document.getElementById("progress");

    progressBar.oninput = function() {
        progressText.textContent = this.value;
    }

    </script>

</body>
</html>
